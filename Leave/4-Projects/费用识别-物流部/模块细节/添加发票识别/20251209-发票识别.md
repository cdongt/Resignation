---
cssclasses: grid-bg
创建时间: 2025-12-09 13:35
最新更新时间: 2025-12-26 11:42
---
## 业务逻辑
1. 外销合同：如果文件有命名，就按文件命名，没有的话就空
2. 船代公司：发票中销售方信息的公司名称
3. 货币代码：只有人民币和美金货币，如果有美金算汇率，
4. 金额：显示每条费用计算后的结果
	- 美金，只要计算汇率 $$  \text{金额} = \text{发票金额} / \text{汇率} $$
	- 人民币，只要计算税率 $$  \text{金额} = \text{发票金额}  \times (1 + \text{税率})$$
		- 如果是免税，则税率为0
5. 备注： 每一条费用都替换成发票中的备注栏


## 后端逻辑

> 费用文件和发票文件的处理逻辑分开

1. 利用`qwen3-vl-plus`输出识别后的markdown
2. 根据提取json数据：
    1. 销售方名称
    2. 项目名称
    3. 金额
    4. 税率/征收率
    5. 税额
    6. 备注
3. 判断是否有税额
    1. 如果税率/征收率的内容不是数字，且税额为空，则没有税额，按照税率为0计算
    2. 其余情况有税率
        - 根据税率做计算，得到每条费用的计算结果
4. 判断是否有汇率
    - 将备注信息发送给`qwen3-max`,提取出金额和汇率信息
        - 有汇率，按照汇率计算，且币别信息要改成美元符号
        - 无汇率，汇率按1计算
5. 综合信息，呈现到gui
    - 外销合同号: 根据文件命名提取，没有的话则为空
    - 船代公司：销售方名称
    - 费用名称：项目名称
    - 货币代码：有汇率则为美金，没汇率就是人民币
    - 金额：每条费用根据税率/汇率计算后的结果
    - 备注：备注




## 前端设计
### 上传数据页面：分成2列
- 左边列上传费用数据
- 右边列上传发票数据


